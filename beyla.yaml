discovery:
  services:
    - open_ports: "1-65535"

  exclude_instrument:
    # Basic selectors
    # - open_ports: 9090

    # Kubernetes selectors
    - k8s_namespace: "kube-*"        # Matches kube-system, kube-public, etc.
    - k8s_namespace: "monitoring"
    - k8s_namespace: "observability"
    - k8s_namespace: "istio-system"
    - k8s_namespace: "flux"
    - k8s_namespace: "gitops"
    # - k8s_pod_name: "redis-*"
    # - k8s_deployment_name: "nginx"
    # - k8s_replicaset_name: "frontend-*"
    - k8s_daemonset_name: "better-stack-collector"
    # - k8s_statefulset_name: "postgres"
    # - k8s_job_name: "backup-*"
    # - k8s_cronjob_name: "cleanup"
    # - k8s_owner_name: "my-deployment"  # Matches any owner type
    - k8s_container_name: "sidecar"

  include_services:
    - exe_path: ".*/frontend$"

  exclude_services:
    - exe_path: ".*/vector$"
    - exe_path: ".*/fluentd$"
    - exe_path: ".*/fluentbit$"
    - exe_path: ".*/load-generator$"

  exclude_otel_instrumented_services: false

otel_metrics_export:
  features: []             # disables groups like application, network
  instrumentations: []     # disables http, grpc, sql, etc

prometheus_export:
  port: 0

network:
  enable: false

otel_traces_export:
  # Required to create trace spans for database operations
  instrumentations:
    - "*"

ebpf:
  # Without this, Beyla only detects MySQL/PostgreSQL binary protocols
  # Enable to capture SQL from ORMs, connection poolers, or other databases
  heuristic_sql_detect: true
  
  # Required for tracking prepared statements which use numeric IDs instead of SQL text
  mysql_prepared_statements_cache_size: 100
  
  # Without adequate buffer size, long SQL queries get truncated
  # 4096 bytes captures most queries without excessive memory usage
  buffer_sizes:
    mysql: 4096
    postgres: 4096

attributes:
  select:
    traces:
      include:
        - "db.query.text"
